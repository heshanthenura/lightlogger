services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    volumes:
      - go_mod_cache:/go/pkg/mod
      - go_build_cache:/root/.cache/go-build
    ports:
      - "8080:8080"
    environment:
      - CGO_ENABLED=0
    develop:
      watch:
        - action: sync+restart
          path: ./
          target: /app
          ignore:
            - bin/
            - tmp/
            - .git/
            - vendor/
            - .dockerignore
            - Dockerfile*
            - compose.yml

  backend-prod:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    ports:
      - "8081:8080"
    profiles:
      - production

volumes:
  go_mod_cache:
  go_build_cache:
